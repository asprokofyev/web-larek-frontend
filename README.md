# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```shell
npm install
npm run start
```

или

```shell
yarn
yarn start
```

## Сборка

```shell
npm run build
```

или

```shell
yarn build
```

## Архитектура приложения

Для реализации приложения выбран паттерн MVP c использованием брокера событий. Такая комбинация позволила реализовать приложение, управляемое событиями, где брокер событий играет роль посредника между различными компонентами. В этом подходе, MVP обеспечивает структуру для разделения ответственности между представлением (View), моделью (Model) и презентатором (Presenter), а брокер событий позволяет компонентам взаимодействовать асинхронно, используя события.

Весь функционал Presenter-а реализован файле - точке входа в приложение `src/index.ts`.

В качестве брокера событий используется класс `EventEmitter` предоставленный в стартовом наборе.

Взаимодействие с серверной частью приложения реализовано за счет расширения базового метода JavaScript `fetch`. Базовый функционал работы с запросами к серверу реализован в классе `Api`, предоставленного в стартовом пакете. Специфический для текущего приложения функционал реализован в классе `WebLarekApi`.

Далее подробное описание всех классов.

## Константы и настройки приложения
**Файл:** `src/utils/constants.ts`

### Назначение
Файл содержит глобальные константы и настройки приложения, включая:
- URL API и CDN
- Текстовые константы для интерфейса
- Настройки валюты
- Классы CSS для категорий товаров

### Константы API

- **`API_URL`**: Базовый URL для API-запросов
```typescript
export const API_URL = `${process.env.API_ORIGIN}/api/weblarek`;
```
Собирается из переменной окружения `API_ORIGIN` с добавлением пути `/api/weblarek`

- **`CDN_URL`***: Базовый URL для доступа к контенту (изображениям, медиа) 
```typescript
export const CDN_URL = `${process.env.API_ORIGIN}/content/weblarek`;
```
Собирается из переменной окружения `API_ORIGIN` с добавлением пути `/content/weblarek`

### Объект настроек `settings`

1. **currency**: Название валюты приложения в родительном падеже
  *Использование*: Для отображения в интерфейсе (например, "Списано 100 синапсов")

### Сообщения (`messages`)

#### Ошибки форм (`formErrors`)
```typescript
phone: 'Необходимо указать телефон',
email: 'Необходимо указать email',
address: 'Необходимо указать адрес доставки',
payment: 'Необходимо выбрать способ оплаты',
```
- **Назначение**: Сообщения об ошибках валидации для различных полей формы

#### Карточка товара (`card`)
```typescript
noprice: 'Бесценно'
```
- **Назначение**: Текст, отображаемый когда товар недоступен для покупки

#### Кнопка покупки (`buyButtonValues`)
```typescript
add: 'Купить',
delete: 'Убрать',
disabled: 'Недоступно',
```
- **Назначение**: Тексты для кнопки покупки в разных состояниях

#### Успешный заказ (`success`)
```typescript
success: 'Списано summa синапсов'
```
- **Назначение**: Шаблон сообщения об успешном заказе
- **Примечание**: `summa` будет заменено на фактическую сумму

#### Корзина (`basket`)
```typescript
empty: 'Корзина пуста'
```
- **Назначение**: Сообщение при пустой корзине

### Классы категорий (`categoryClasses`)
```typescript
'другое': 'card__category_other',
'софт-скил': 'card__category_soft',
'дополнительное': 'card__category_additional',
'кнопка': 'card__category_button',
'хард-скил': 'card__category_hard',
```
- **Назначение**: Маппинг названий категорий на CSS-классы для стилизации
- **Формат**: 
  - Ключ: название категории из API
  - Значение: соответствующий CSS-класс

## Использование в проекте
1. Импорт констант:
```typescript
import { API_URL, CDN_URL, settings } from './config';
```

2. Пример использования:
```typescript
// API запрос
fetch(`${API_URL}/products`)

// Отображение сообщения
alert(settings.messages.formErrors.email)

// Получение класса для категории
const categoryClass = settings.categoryClasses[product.category]
```

## Особенности
- Все текстовые константы собраны в одном месте для удобства локализации
- Настройки стилей категорий централизованы для согласованности интерфейса
- URL API и CDN конфигурируются через переменные окружения


## Ключевые типы данных

## Базовый код

1. **Класс `API`**

2. **Класс `Component<T>`**

3. **Класс `EventEmitter`**

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

Класс имеет методы `on`, `off`, `emit` — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.

Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков.

Интересным дополнением является метод `trigger`, генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

4. **`Model<T>`**

## Модель данных (бизнес-логика)

### Класс WebLarek

Класс `WebLarek` содержит состояние всего приложения и управляет этим состоянием. Класс управляет каталогом товаров, корзиной покупок и процессом оформления заказа.

```typescript
export class WebLarek extends Model<IWebLarekState>
```

Класс наследуется от базового класса `Model` с указанием типа состояния `IWebLarekState`.

#### Свойства

1. `catalog: IProduct[]`
   Массив товаров каталога магазина.

2. `order: IOrder`
   Объект, содержащий информацию о текущем заказе:

- `email`: string - email покупателя
- `phone`: string - телефон покупателя
- `payment`: string - способ оплаты
- `address`: string - адрес доставки
- `items`: string[] - массив идентификаторов товаров в корзине
- `total`: number - общая сумма заказа

3. `preview: string | null`
   Идентификатор товара, который в данный момент просматривается в модальном окне (или null, если ничего не просматривается).

4. `formErrors: FormErrors`
   Объект, содержащий ошибки валидации форм.

#### Методы

1. `setProducts(items: IProduct[]): void`
   Сохраняет данные каталога, полученные из API.

- `items` - массив товаров
- Генерирует событие `'products:changed'`

2. `getProduct(id: string): IProduct`
   Возвращает данные конкретного товара по его идентификатору.

- `id` - идентификатор товара
- Возвращает объект товара или undefined, если товар не найден

3. `addToBasket(id: string): void`
   Добавляет товар в корзину.

- `id` - идентификатор товара
- Обновляет общую сумму заказа
- Генерирует событие `'products:changed'`

4. `deleteFromBasket(id: string): void`
   Удаляет товар из корзины.

- `id` - идентификатор товара
- Обновляет общую сумму заказа
- Генерирует событие `'products:changed'`

5. `inBasket(id: string): boolean`
   Проверяет наличие товара в корзине.

- `id` - идентификатор товара
- Возвращает `true`, если товар есть в корзине, иначе `false`

6. `getProductsInBasketCount(): number`
   Возвращает количество товаров в корзине.

7. `getTotal(): number`
   Вычисляет общую стоимость товаров в корзине.

8. `clearBasket(): void`
   Очищает корзину после успешного оформления заказа.

- Сбрасывает все поля заказа
- Генерирует событие `'products:changed'`

9. `setOrderField(field: keyof IOrderForm, value: string): void`
   Устанавливает значение поля заказа (шаг 1 оформления).

- `field` - название поля ('payment' или 'address')
- `value` - значение поля
- Вызывает валидацию формы заказа

10. `setContactsField(field: keyof IOrderForm, value: string): void`
    Устанавливает значение поля контактов (шаг 2 оформления).

- `field` - название поля ('email' или 'phone')
- `value` - значение поля
- Вызывает валидацию формы контактов

11. `validateOrder(): void`
    Проверяет валидность данных заказа (шаг 1).

- Устанавливает ошибки в `formErrors`
- Генерирует событие `'orderFormErrors:change'` с текущими ошибками

12. `validateContacts(): void`
    Проверяет валидность контактных данных (шаг 2).

- Устанавливает ошибки в `formErrors`
- Генерирует событие `'contactsFormErrors:change'` с текущими ошибками

13. `setPreview(item: IProduct): void`
    Устанавливает товар для просмотра в модальном окне.

- `item` - объект товара
- Устанавливает `preview` в ID товара
- Генерирует событие `'preview:changed'` с данными товара

#### Использование событий

Класс генерирует следующие события:

- `'products:changed'` - при изменении каталога или корзины
- `'orderFormErrors:change'` - при изменении ошибок формы заказа
- `'contactsFormErrors:change'` - при изменении ошибок формы контактов
- `'preview:changed'` - при изменении просматриваемого товара

## Компоненты представления

1. Класс Page

2. Класс Modal

3. Класс Form<T>

4. Класс Order

5. Класс Contacts

6. Класс Card

7. Класс Basket

8. Класс Success

## Презентер `src/index.ts`

## Компоненты работы с API

1. Класс WebLarekApi

## Размещение в сети

Рабочая версия проекта доступна по адресу:
